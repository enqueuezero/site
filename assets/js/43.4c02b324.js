(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{432:function(e,t,o){"use strict";o.r(t);var n=o(54),r=Object(n.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h2",{attrs:{id:"context"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[e._v("#")]),e._v(" Context")]),e._v(" "),o("p",[e._v("It’s a fundamental requirement that we need to run a command at a specific time.")]),e._v(" "),o("h2",{attrs:{id:"overview"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),o("p",[e._v("Periodical Scheduler schedules code to be executed periodically. It has below features:")]),e._v(" "),o("ul",[o("li",[e._v("Job managing, meaning adding new jobs, removing old ones, or modifying existing ones.")]),e._v(" "),o("li",[e._v("Job storing.")]),e._v(" "),o("li",[e._v("Run as a long-running process.")])]),e._v(" "),o("h2",{attrs:{id:"solutions"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#solutions"}},[e._v("#")]),e._v(" Solutions")]),e._v(" "),o("h3",{attrs:{id:"crontab"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#crontab"}},[e._v("#")]),e._v(" Crontab")]),e._v(" "),o("p",[e._v("Crontab is a Unix utility that gets installed in almost every Unix / Linux distribution.")]),e._v(" "),o("ul",[o("li",[e._v("You can run "),o("code",[e._v("crontab -e")]),e._v(" to edit jobs, which will prompt you an editor.\n"),o("ul",[o("li",[e._v("To remove jobs, you need to remove those lines defining jobs.")]),e._v(" "),o("li",[e._v("To add a new job, you will need to add a new line of definition in the form like "),o("code",[e._v("*/5 * * * * /opt/my-lib/bin/my-prog")]),e._v(". The first five fields are minute, hour, the day of a month, month, and the day of a week. The last field is the command.")])])]),e._v(" "),o("li",[e._v("In most Linux distros, per user crontab are typically stored in "),o("code",[e._v("/var/spool/cron/crontabs/{username}")]),e._v(".")]),e._v(" "),o("li",[e._v("The long-running process is a daemon called "),o("code",[e._v("crond")]),e._v(".")])]),e._v(" "),o("p",[e._v("Check the manual of "),o("a",{attrs:{href:"https://man7.org/linux/man-pages/man5/crontab.5.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("crontab"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("h3",{attrs:{id:"kubernetes-cronjob"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-cronjob"}},[e._v("#")]),e._v(" Kubernetes CronJob")]),e._v(" "),o("p",[e._v("Kubernetes Cron Job is like crontab file in my forms except that it runs in a Kubernetes cluster.")]),e._v(" "),o("ul",[o("li",[e._v("To manage the Kubernetes CronJob, you need to write a YAML file and apply to the Kubernetes API Master.")]),e._v(" "),o("li",[e._v("Jobs are stored in Etcd.")]),e._v(" "),o("li",[e._v("The Kubernetes API Master does the scheduling work.")])]),e._v(" "),o("p",[e._v("Check the documentation of "),o("a",{attrs:{href:"https://kubernetes.io/docs/tasks/job/automated-tasks-with-cron-jobs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Running Automated Tasks with a CronJob"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("h3",{attrs:{id:"scheduler-libraries"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#scheduler-libraries"}},[e._v("#")]),e._v(" Scheduler Libraries")]),e._v(" "),o("p",[e._v("Scheduler libraries let you schedule code to be executed later. Below are some typical implementations:")]),e._v(" "),o("ul",[o("li",[o("p",[e._v("APScheduler for Python")])]),e._v(" "),o("li",[o("p",[e._v("Whenever for Ruby")])]),e._v(" "),o("li",[o("p",[e._v("To manage the jobs, you usually need to call functions like "),o("code",[e._v("add_job")]),e._v(", "),o("code",[e._v("remove_job")]),e._v(", etc.")]),e._v(" "),o("ul",[o("li",[e._v("Some libraries enables you managing jobs at runtime. Some applications ships with a web UI to manage jobs.")])])]),e._v(" "),o("li",[o("p",[e._v("The definition of scheduler libraries varies but is generally flexible. It supports cron-style definition, and also an embed DSL for managing jobs. You might get a chance to define jobs in the form like "),o("code",[e._v("every 1.hour { run 'my job' }")]),e._v(".")])]),e._v(" "),o("li",[o("p",[e._v("The libraries generally need to run as a single process and managed by supervisor software.")])])]),e._v(" "),o("p",[e._v("The libraries are useful when you want to integrate scheduler into your application.")]),e._v(" "),o("h2",{attrs:{id:"patterns"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#patterns"}},[e._v("#")]),e._v(" Patterns")]),e._v(" "),o("ul",[o("li",[e._v("A single periodic job can create multiple instances. Therefore, to avoid duplicate running jobs, we need to ensure that the jobs are idempotent, meaning they can run several times without side-effect.")]),e._v(" "),o("li",[e._v("The periodic scheduler generally runs as a single instance.")]),e._v(" "),o("li",[e._v("The instances for a periodic job usually runs in a thread or process for isolation.")]),e._v(" "),o("li",[e._v("Limiting the number of concurrently executing instances is essential. If a task runs over the window, you need to decide if the scheduler needs to trigger the next job.")]),e._v(" "),o("li",[e._v("Sometimes the scheduler might miss triggering job executions. You need to determine whether the scheduler needs to trigger the missed job.")]),e._v(" "),o("li",[e._v("Logging for the scheduler is a bonus. It can help end users do troubleshooting.")])]),e._v(" "),o("h2",{attrs:{id:"conclusions"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#conclusions"}},[e._v("#")]),e._v(" Conclusions")]),e._v(" "),o("p",[e._v("Using crontab is the easiest way to schedule periodic jobs. The limitation is that you can’t control the resource usage and it’s less flexible. To run periodic jobs in a fine-controlled environment, you might want to choose Kubernetes CronJob. To leverage the power of periodic scheduler, you might want to integrate a scheduler library into your application.")])])}),[],!1,null,null,null);t.default=r.exports}}]);