(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{494:function(e,t,a){"use strict";a.r(t);var s=a(54),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"wsgi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wsgi"}},[e._v("#")]),e._v(" WSGI")]),e._v(" "),a("p",[e._v("WSGI or Web Server Gateway Interface is a specification of "),a("a",{attrs:{href:"https://www.python.org/dev/peps/pep-3333",target:"_blank",rel:"noopener noreferrer"}},[e._v("PEP 3333"),a("OutboundLink")],1),e._v(" that defines how the web server communicates with Python web applications.")]),e._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#overview"}},[e._v("Overview")])]),a("li",[a("a",{attrs:{href:"#basic-concepts"}},[e._v("Basic Concepts")]),a("ul",[a("li",[a("a",{attrs:{href:"#data-flow"}},[e._v("Data Flow")])]),a("li",[a("a",{attrs:{href:"#web-server"}},[e._v("Web Server")])]),a("li",[a("a",{attrs:{href:"#response-iterable"}},[e._v("Response Iterable")])]),a("li",[a("a",{attrs:{href:"#middlewares"}},[e._v("Middlewares")])])])]),a("li",[a("a",{attrs:{href:"#things-not-defined-in-wsgi"}},[e._v("Things not defined in WSGI")])]),a("li",[a("a",{attrs:{href:"#booming-web-frameworks-and-servers"}},[e._v("Booming Web Frameworks and Servers")]),a("ul",[a("li",[a("a",{attrs:{href:"#async-incompatible"}},[e._v("Async Incompatible")])])])]),a("li",[a("a",{attrs:{href:"#comparisons"}},[e._v("Comparisons")]),a("ul",[a("li",[a("a",{attrs:{href:"#wsgi-v-s-ring"}},[e._v("WSGI v/s Ring")])]),a("li",[a("a",{attrs:{href:"#wsgi-v-s-rack"}},[e._v("WSGI v/s Rack")])])])]),a("li",[a("a",{attrs:{href:"#pros-and-cons"}},[e._v("Pros and Cons")])]),a("li",[a("a",{attrs:{href:"#references"}},[e._v("References")])])])]),a("p"),e._v(" "),a("h2",{attrs:{id:"overview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),a("ul",[a("li",[e._v("WSGI is a contract of the HTTP application API in Python world.")]),e._v(" "),a("li",[e._v("WSGI is not an application, a server, or a software.")]),e._v(" "),a("li",[e._v("WSGI has application side and server side.\n"),a("ul",[a("li",[e._v("Application-side provides a function and return a value.")]),e._v(" "),a("li",[e._v("Server-side sends the function parameters in and handle the returned value.")])])]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.python.org/dev/peps/pep-3333",target:"_blank",rel:"noopener noreferrer"}},[e._v("PEP 3333"),a("OutboundLink")],1),e._v(" defines all aspects on WSGI.\n"),a("ul",[a("li",[e._v("However, you don't necessarily need to read the full spec just for knowing what it is.")])])])]),e._v(" "),a("h2",{attrs:{id:"basic-concepts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#basic-concepts"}},[e._v("#")]),e._v(" Basic Concepts")]),e._v(" "),a("h3",{attrs:{id:"data-flow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-flow"}},[e._v("#")]),e._v(" Data Flow")]),e._v(" "),a("p",[e._v("Below is a simplified graph of components defined in WSGI.")]),e._v(" "),a("img",{attrs:{src:'https://g.gravizo.com/svg?@startuml; actor User; participant "Server" as A; participant "Application" as B; User -> A: Raw HTTP Request; activate A; A -> B: Call WSGI app(env, start_response); activate B; B --\x3e A: Return Iterable; deactivate B; A --\x3e User: Raw HTTP Response; deactivate A; @enduml '}}),e._v(" "),a("h3",{attrs:{id:"web-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-server"}},[e._v("#")]),e._v(" Web Server")]),e._v(" "),a("p",[e._v("The web server is a server application that listens on a socket binding "),a("code",[e._v("host:port")]),e._v(".\nOnce an HTTP request lands on the socket, the web server calls function "),a("code",[e._v("app(environ, start_response)")]),e._v(".")]),e._v(" "),a("ul",[a("li",[e._v("The "),a("code",[e._v("app")]),e._v(" is registered by the application before running the web server.")]),e._v(" "),a("li",[e._v("The "),a("code",[e._v("environ")]),e._v(" dict wraps raw HTTP requests, including methods, URL, query string, body, etc.")]),e._v(" "),a("li",[e._v("The "),a("code",[e._v("start_response")]),e._v(" callable accepts two parameter: "),a("code",[e._v("status_code")]),e._v(" and "),a("code",[e._v("response_headers")]),e._v(".")])]),e._v(" "),a("h3",{attrs:{id:"response-iterable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#response-iterable"}},[e._v("#")]),e._v(" Response Iterable")]),e._v(" "),a("p",[e._v("The iterable as the response makes WSGI available for both streaming response and non-streaming response. The string, list, or any Python iterable object can be used as responses.")]),e._v(" "),a("p",[e._v("Below is the pseudo code of how web server transforms and sends iterable to the client:")]),e._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# server side code")]),e._v("\niterable "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" start_response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" chunk "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" iterable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("send_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("chunk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("For non-streaming response, you would more want to return "),a("code",[e._v('return ["hello world"]')]),e._v(" than to "),a("code",[e._v('return "hello word"')]),e._v(". The latter case would lead to sending one byte at a time to the client.")]),e._v(" "),a("h3",{attrs:{id:"middlewares"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#middlewares"}},[e._v("#")]),e._v(" Middlewares")]),e._v(" "),a("p",[e._v("WSGI makes pre-processing and post-processing easy.\nThings people usually do but not wanna introduce into app code include gzip, throttle, rate limiting, proxy, etc.")]),e._v(" "),a("p",[e._v("The implementation is to let middleware expose the same interface and do extra work, pretty like what Python decorator does.\nIt implies that eventually, you would expose the middleware app as WSGI server side entry point.")]),e._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" start_response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# your app code")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("my_middleware")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" start_response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# this will be used as entrypoint")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# do pre-processing")]),e._v("\n    iterable "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" start_response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# do post-processing")]),e._v("\n")])])]),a("h2",{attrs:{id:"things-not-defined-in-wsgi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#things-not-defined-in-wsgi"}},[e._v("#")]),e._v(" Things not defined in WSGI")]),e._v(" "),a("p",[e._v("WSGI does not define below concepts:")]),e._v(" "),a("ul",[a("li",[e._v("URL routing")]),e._v(" "),a("li",[e._v("Templating")]),e._v(" "),a("li",[e._v("Request object")]),e._v(" "),a("li",[e._v("Response object")]),e._v(" "),a("li",[e._v("Session")]),e._v(" "),a("li",[e._v("Cookie")]),e._v(" "),a("li",[e._v("Database")]),e._v(" "),a("li",[e._v("MVC")]),e._v(" "),a("li",[e._v("Application testing")]),e._v(" "),a("li",[e._v("Form handling")]),e._v(" "),a("li",[e._v("Error handling")]),e._v(" "),a("li",[e._v("Application configuration")]),e._v(" "),a("li",[e._v("Application security")]),e._v(" "),a("li",[e._v("...")])]),e._v(" "),a("p",[e._v("WSGI leaves a lot of things TBD as it's only to define an entry point for your vanilla application.")]),e._v(" "),a("h2",{attrs:{id:"booming-web-frameworks-and-servers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#booming-web-frameworks-and-servers"}},[e._v("#")]),e._v(" Booming Web Frameworks and Servers")]),e._v(" "),a("p",[e._v("Web frameworks are booming since the invent of WSGI. Every web framework has its philosophy and design. However, they expose the same interface defined by WSGI.")]),e._v(" "),a("p",[e._v("And so as web servers. People wrote dozens of web servers that supports WSGI.")]),e._v(" "),a("p",[e._v("As a result, you can choose a framework and a web server from hundreds of options.")]),e._v(" "),a("p",[e._v("Among them, some are gorgeous.")]),e._v(" "),a("ul",[a("li",[e._v("Web Frameworks\n"),a("ul",[a("li",[e._v("Django")]),e._v(" "),a("li",[e._v("Flask")]),e._v(" "),a("li",[e._v("Pyramid")]),e._v(" "),a("li",[e._v("Falcon")])])]),e._v(" "),a("li",[e._v("Web Servers\n"),a("ul",[a("li",[e._v("uWSGI")]),e._v(" "),a("li",[e._v("Gunicorn")]),e._v(" "),a("li",[e._v("wsgiref")])])])]),e._v(" "),a("h3",{attrs:{id:"async-incompatible"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#async-incompatible"}},[e._v("#")]),e._v(" Async Incompatible")]),e._v(" "),a("p",[e._v("WSGI does not naturally fit async programming.")]),e._v(" "),a("p",[e._v("We just can't change the function interface to a async coroutine like below due to the breaking change of the API.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# NOT WORKING\nasync def app(env, start_response):\n    return Interable\n")])])]),a("p",[e._v("However, it doesn't mean WSGI cannot run in Async server.\nA possible way is to wrap "),a("code",[e._v("app")]),e._v(" running in a threadpool and manage the "),a("code",[e._v("Thread")]),e._v(" by async event loop.\nNote that everything running in "),a("code",[e._v("app")]),e._v(" is still synchronous.")]),e._v(" "),a("h2",{attrs:{id:"comparisons"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#comparisons"}},[e._v("#")]),e._v(" Comparisons")]),e._v(" "),a("h3",{attrs:{id:"wsgi-v-s-ring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wsgi-v-s-ring"}},[e._v("#")]),e._v(" WSGI v/s Ring")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/ring-clojure/ring",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ring"),a("OutboundLink")],1),e._v(" is low-level interface and library for building web applications in the Clojure programming language. It's similar to WSGI in Python.")]),e._v(" "),a("p",[e._v("Unlike WSGI having "),a("code",[e._v("app")]),e._v(", "),a("code",[e._v("env")]),e._v(", "),a("code",[e._v("start_response")]),e._v(" and "),a("code",[e._v("Interable")]),e._v(", Ring has other four concepts: "),a("code",[e._v("Handler")]),e._v(", "),a("code",[e._v("Request")]),e._v(", "),a("code",[e._v("Response")]),e._v(", "),a("code",[e._v("Middleware")]),e._v(", among which the "),a("code",[e._v("Handler")]),e._v(" is very like "),a("code",[e._v("app")]),e._v(". However, the "),a("code",[e._v("Handler")]),e._v(" only accepts "),a("code",[e._v("Request")]),e._v(" as the parameter and returns "),a("code",[e._v("Response")]),e._v(". Both "),a("code",[e._v("Request")]),e._v(" and "),a("code",[e._v("Response")]),e._v(" are a dictionary-like object. Please refer to "),a("a",{attrs:{href:"https://github.com/ring-clojure/ring/wiki/Concepts",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ring wiki"),a("OutboundLink")],1),e._v(" for more details about these concepts.")]),e._v(" "),a("p",[e._v("As a comparison, Ring provides higher level concepts than WSGI.")]),e._v(" "),a("h3",{attrs:{id:"wsgi-v-s-rack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wsgi-v-s-rack"}},[e._v("#")]),e._v(" WSGI v/s Rack")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://rack.github.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Rack"),a("OutboundLink")],1),e._v(" provides a minimal interface between web servers and Ruby web applications. It's also similar to WSGI in Python.")]),e._v(" "),a("p",[e._v("In Rack, you need to provide an "),a("code",[e._v("app")]),e._v(" as well, which is the same in WSGI.  Rack requires "),a("code",[e._v("app")]),e._v(" taking an environment hash as the parameter, and returning an "),a("code",[e._v("Array")]),e._v(" in the form like "),a("code",[e._v("[status_code, headers, body]")]),e._v(". The "),a("code",[e._v("status_code")]),e._v(" is a string form of HTTP response code, the hash of headers is for HTTP response headers, and the body must be able to respond to "),a("code",[e._v("each")]),e._v(" method (just like "),a("code",[e._v("Iterable")]),e._v(" in Python).")]),e._v(" "),a("p",[e._v("We can see that Rack reduces the "),a("code",[e._v("start_response")]),e._v(" parameter but moves the necessary information into the return value.")]),e._v(" "),a("h2",{attrs:{id:"pros-and-cons"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pros-and-cons"}},[e._v("#")]),e._v(" Pros and Cons")]),e._v(" "),a("ul",[a("li",[e._v("Advantages\n"),a("ul",[a("li",[e._v("Standardize and unified interface.")])])]),e._v(" "),a("li",[e._v("Disadvantages\n"),a("ul",[a("li",[e._v("Only support synchronize paradigm. Not support for the async paradigm.")])])])]),e._v(" "),a("h2",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://wsgi.readthedocs.io/en/latest/learn.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Learn about WSGI"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.cabotsolutions.com/2017/11/a-detailed-study-of-wsgi-web-server-gateway-interface-of-python",target:"_blank",rel:"noopener noreferrer"}},[e._v("A Detailed Study of WSGI - Web Server Gateway Interface of Python"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://quantmind.github.io/pulsar/apps/wsgi/async.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Asynchronous WSGI"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://stackoverflow.com/questions/34109324/what-makes-wsgi-is-synchronous-in-nature",target:"_blank",rel:"noopener noreferrer"}},[e._v("What makes WSGI is synchronous in nature?"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://bottlepy.org/docs/dev/async.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Primer to Asynchronous Applications"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);