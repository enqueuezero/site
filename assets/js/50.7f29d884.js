(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{439:function(e,t,s){"use strict";s.r(t);var a=s(54),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"skipper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skipper"}},[e._v("#")]),e._v(" Skipper")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/zalando/skipper/master/img/skipper-h180.png",alt:"Skipper"}})]),e._v(" "),s("h2",{attrs:{id:"overview"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),s("p",[e._v("Skipper is an HTTP router and reverse proxy software written in Golang.\nIt has two goals:")]),e._v(" "),s("ul",[s("li",[e._v("To handle a large amount of concurrent HTTP routes.")]),e._v(" "),s("li",[e._v("To provide decent ways of HTTP routes configurations.")])]),e._v(" "),s("h2",{attrs:{id:"use"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#use"}},[e._v("#")]),e._v(" Use")]),e._v(" "),s("ul",[s("li",[e._v("It can route requests to different destinations based on the request metadata, such as HTTP method, path, query parameters, headers, etc.")]),e._v(" "),s("li",[e._v("It can modify requests and responses.")]),e._v(" "),s("li",[e._v("It can stream requests and responses.")]),e._v(" "),s("li",[e._v("It can hot-reload routing rules.")]),e._v(" "),s("li",[e._v("It can serve as a static file server.")]),e._v(" "),s("li",[e._v("It can serve as Kubernetes Ingress controller.")])]),e._v(" "),s("h2",{attrs:{id:"concepts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#concepts"}},[e._v("#")]),e._v(" Concepts")]),e._v(" "),s("h3",{attrs:{id:"http-proxy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-proxy"}},[e._v("#")]),e._v(" HTTP Proxy")]),e._v(" "),s("p",[e._v("An HTTP proxy is a middleman in-between HTTP client and HTTP server.")]),e._v(" "),s("p",[e._v("With the HTTP proxy software running,")]),e._v(" "),s("ol",[s("li",[e._v("The client sends a request to the proxy first.")]),e._v(" "),s("li",[e._v("Then, the proxy forwards the request to the server.")]),e._v(" "),s("li",[e._v("Afterward, the server sends the response to the proxy.")]),e._v(" "),s("li",[e._v("Finally, the proxy receives the response and forwards back to the client.")])]),e._v(" "),s("mermaid",[e._v("\nsequenceDiagram\n    Client->>Proxy: 1. send request\n    activate Proxy\n    Proxy->>Server: 2. forward request\n    activate Server\n    Server->>Proxy: 3. send response\n    deactivate Server\n    Proxy->>Client: 4. forward response\n    deactivate Proxy\n")]),e._v(" "),s("h3",{attrs:{id:"route"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#route"}},[e._v("#")]),e._v(" Route")]),e._v(" "),s("p",[e._v("In networking, a route is a path for traffic in a network, or between or across multiple networks.  In Skipper, the route is an entry in a table, which defines where should the request be proxied to.")]),e._v(" "),s("p",[e._v("A route consists of below information.")]),e._v(" "),s("ul",[s("li",[e._v("One or more predicates, which are for finding a path for the request.")]),e._v(" "),s("li",[e._v("One or more filters, which are for modifying the request and the response.")]),e._v(" "),s("li",[e._v("The target, which can be a backend HTTP server, or solely handled by Skipper.")])]),e._v(" "),s("p",[e._v("Below is the simplified Go code.")]),e._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" Route "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The preprocessed custom predicate instances.")]),e._v("\n    Predicates "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("Predicate\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The preprocessed filter instances.")]),e._v("\n    Filters "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("RouteFilter\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The backend scheme and host.")]),e._v("\n    Scheme"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Path "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("h3",{attrs:{id:"routing-table"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#routing-table"}},[e._v("#")]),e._v(" Routing Table")]),e._v(" "),s("p",[e._v("The routing table stores all routes. It's a list in the memory.")]),e._v(" "),s("h3",{attrs:{id:"predicates"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#predicates"}},[e._v("#")]),e._v(" Predicates")]),e._v(" "),s("p",[e._v("Predicates are tools in a route for matching a request.")]),e._v(" "),s("p",[e._v("For example, below route has three predicates matching designated host, method, and path.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('foo:\n    Host("enqueuezero.com")\n    && Method("GET")\n    && Path("/concrete-architecture/skipper.html")\n    -> "http://0.0.0.0:8080/";\n')])])]),s("p",[e._v("Except host, method, and path, predicates can also match headers, cookies, time frames, query parameters, source IP addresses, etc.")]),e._v(" "),s("h3",{attrs:{id:"filters"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#filters"}},[e._v("#")]),e._v(" Filters")]),e._v(" "),s("p",[e._v("Filters are tools in a route for modifying the request and the response.")]),e._v(" "),s("p",[e._v("For example, sometimes we want to add a header to the HTTP request.")]),e._v(" "),s("mermaid",[e._v('\ngraph LR\n    A["-X GET https://enqueuezero.com"]\n    B("-X GET https://enqueuezero.com -H\'X-Routed-By: skipper\'")\n    A--\x3eB\n')]),e._v(" "),s("p",[e._v("Below route has a filter adding a header to the request before proxying to the backend HTTP.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('foo: * -> setRequestHeader("X-Routed-By", "skipper") -> "https://enqueuezero.com";\n')])])]),s("p",[e._v("Except adding header to the request, there are dozens of built-in functions for different features, such as dropping headers, modifying path, redirection, setting static directory, etc.")]),e._v(" "),s("h3",{attrs:{id:"scripts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#scripts"}},[e._v("#")]),e._v(" Scripts")]),e._v(" "),s("p",[e._v("Skipper has a built-in LUA engine for running scripts as filters.")]),e._v(" "),s("p",[e._v("For example, below script set a header to the request.")]),e._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"X-Routed-By"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"skipper"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("end")]),e._v("\n")])])]),s("p",[e._v("You can either load a file in the file system or use inline Lua code in the routes.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('foo: * -> lua("/path/to/script.lua") -> "https://enqueuezero.com";\nbar: * -> lua("function request(c, p); print(c.request.url); end");\n')])])]),s("h3",{attrs:{id:"plugins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#plugins"}},[e._v("#")]),e._v(" Plugins")]),e._v(" "),s("p",[e._v("Plugins are dynamically linked libraries in the plugin directories, for example, "),s("code",[e._v("$cwd/plugins/plugin.so")]),e._v(". Any file with the suffix "),s("code",[e._v(".so")]),e._v(" found in the plugin directories will be loaded.")]),e._v(" "),s("mermaid",[e._v("\nsequenceDiagram\n   src ->> .so: $ go build -o plugin.so\n   .so ->> ./plugins : $ mv plugin.so ./plugins\n   ./plugins ->> runtime: `$ skipper` finds and loads .so\n")]),e._v(" "),s("p",[e._v("The implementations of plugins are not in the core codebase of skipper. To get a "),s("code",[e._v(".so")]),e._v(" file, as a plugin developer, you need to use "),s("code",[e._v("go build")]),e._v(" like below.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("GO111MODULE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("on go build -buildmode"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("plugin -o example.so example.go\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mv")]),e._v(" example.so /path/to/skipper/plugins/example.so\n$ skipper\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("APP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" found plugin example at plugins/example.so\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("APP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" loaded plugin example from plugins/example.so\n")])])]),s("h3",{attrs:{id:"data-clients"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-clients"}},[e._v("#")]),e._v(" Data Clients")]),e._v(" "),s("p",[e._v("Data clients pull routes from various sources, such as static files, dynamic Kubernetes ingress objects, etc.")]),e._v(" "),s("mermaid",[e._v("\ngraph TB\n    dataclient --\x3e route-files;\n    dataclient --\x3e route-strings;\n    dataclient --\x3e kubernetes-ingress;\n    dataclient --\x3e etcd;\n    dataclient --\x3e inkeeper;\n")]),e._v(" "),s("h2",{attrs:{id:"layered-architecture"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#layered-architecture"}},[e._v("#")]),e._v(" Layered Architecture")]),e._v(" "),s("p",[e._v("Skipper's internal package are organized in layers. It has three layers: proxy, skipper, and dataclient.\nThe upstream layer reads data from the downstream layers.")]),e._v(" "),s("mermaid",[e._v("\ngraph TB\n    proxy --\x3e skipper;\n    skipper --\x3e dataclient;\n")]),e._v(" "),s("ul",[s("li",[e._v("The proxy layer handles requests based on the routes populated by downstream layer skipper.")]),e._v(" "),s("li",[e._v("The skipper layer pulls routes from different sources in dataclient layer.")]),e._v(" "),s("li",[e._v("The dataclient layer read routes from either static files or network remote calls.")])]),e._v(" "),s("h2",{attrs:{id:"route-processing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#route-processing"}},[e._v("#")]),e._v(" Route Processing")]),e._v(" "),s("p",[e._v("For each incoming request, skipper routes them following below rules.")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("proxy")]),e._v(" create a request context.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" looks up from the routing table by matching predicates.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" found the route.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" checks rate limit and circuit breaker.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" applies all filters to the request.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" forwards the request to a backend, "),s("code",[e._v("<shunt>")]),e._v(", or "),s("code",[e._v("<loopback>")]),e._v(".")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" retries if the forwarding encounters a network error.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" waits from backend processing.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" received backend response.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" applies all filters to the response.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" forwards the response back to the client.")])]),e._v(" "),s("h2",{attrs:{id:"conclusions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#conclusions"}},[e._v("#")]),e._v(" Conclusions")]),e._v(" "),s("p",[e._v("Skipper is an HTTP router and reverse proxy for service composition. The internal modules are well-decoupled and extendable.\nIt makes adding new data sources and new routing strategies without losing performance.")])],1)}),[],!1,null,null,null);t.default=r.exports}}]);