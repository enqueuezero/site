(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{496:function(e,t,s){"use strict";s.r(t);var a=s(54),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"context"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[e._v("#")]),e._v(" Context")]),e._v(" "),s("p",[e._v("URI links live everywhere outside the website itself, so we tend to change URIs as less as possible. Check more on "),s("a",{attrs:{href:"https://www.w3.org/Provider/Style/URI",target:"_blank",rel:"noopener noreferrer"}},[e._v("Hypertext Style: Cool URIs don't change"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("p",[e._v("Most modern web frameworks provide a component called "),s("code",[e._v("Router")]),e._v(" or "),s("code",[e._v("URLDispatcher")]),e._v(" to resolve a function or method to handle requests to URLs.")]),e._v(" "),s("h2",{attrs:{id:"patterns"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#patterns"}},[e._v("#")]),e._v(" Patterns")]),e._v(" "),s("h3",{attrs:{id:"request-process"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request-process"}},[e._v("#")]),e._v(" Request Process")]),e._v(" "),s("p",[e._v("A typical request processing routine is as below:")]),e._v(" "),s("ul",[s("li",[e._v("Web framework loads URL resolution map. Each rule is bound to a handling class, or function, or method.")]),e._v(" "),s("li",[e._v("When request comes, web framework iterates through each route in defining order sequence and stops at the first matching route.")]),e._v(" "),s("li",[e._v("Once the URL rule matches, web framework construct request information and pass it to the handling class, or function, or method.")]),e._v(" "),s("li",[e._v("A 404 exception is raised when no rule matches.")])]),e._v(" "),s("h3",{attrs:{id:"resolution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resolution"}},[e._v("#")]),e._v(" Resolution")]),e._v(" "),s("p",[e._v("There are many means to determine which function to execute for an URL.")]),e._v(" "),s("ul",[s("li",[e._v("Regex Resolution")]),e._v(" "),s("li",[e._v("Template Resolution")]),e._v(" "),s("li",[e._v("Directory Resolution")]),e._v(" "),s("li",[e._v("Function Resolution")])]),e._v(" "),s("p",[e._v("Among them, Regex Resolution and Template Resolution are the most popular.")]),e._v(" "),s("h4",{attrs:{id:"regex-resolution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#regex-resolution"}},[e._v("#")]),e._v(" Regex Resolution")]),e._v(" "),s("p",[e._v("Regex is a string pattern matching technique. We define URL regex first, and web framework will apply URLs to regex one by one until matching.")]),e._v(" "),s("p",[e._v("For example, in Django, you can define rules like below code:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("from django.urls import re_path\nfrom . import view\n\nurlpatterns = [\n    re_path(r'posts/(?P<id>\\d+/$', view.get_post),\n    re_path(r'posts/(?P<id>\\d+/comments/$', view.get_post_comment),\n]\n")])])]),s("p",[e._v("Above code can resolute "),s("code",[e._v("/posts/42")]),e._v(" to "),s("code",[e._v("view.get_post")]),e._v(" to execute; resolute "),s("code",[e._v("/posts/42/comments")]),e._v(" to "),s("code",[e._v("view.get_post_comment")]),e._v(" to execute.")]),e._v(" "),s("p",[e._v("Regex is very fast because the expressions are generally pre-compiled when web application loaded.")]),e._v(" "),s("h4",{attrs:{id:"template-resolution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#template-resolution"}},[e._v("#")]),e._v(" Template Resolution")]),e._v(" "),s("p",[e._v("Regex is hard to read, so people invent template string to make it more readable.")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://tools.ietf.org/html/rfc6570",target:"_blank",rel:"noopener noreferrer"}},[e._v("RFC 6570: URI Template"),s("OutboundLink")],1),e._v(" is among one of the most popular solutions. It defines expressions by "),s("code",[e._v("{")]),e._v(" and "),s("code",[e._v("}")]),e._v(". For example,")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("/posts{/id}")]),e._v(" matches "),s("code",[e._v("/posts/42")]),e._v(".")]),e._v(" "),s("li",[s("code",[e._v("/posts{/id*}")]),e._v(" matches "),s("code",[e._v("/posts/42/comments")]),e._v(", "),s("code",[e._v("/posts/42/likes")]),e._v(", etc.")])]),e._v(" "),s("p",[e._v("Another popular solution is to use angle bracket "),s("code",[e._v("<")]),e._v(" and "),s("code",[e._v(">")]),e._v(". For example,")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("/posts/<int:id>")]),e._v(" matches "),s("code",[e._v("/posts/42")]),e._v(".")]),e._v(" "),s("li",[s("code",[e._v("/posts/<int:id>/comments")]),e._v(" matches "),s("code",[e._v("/posts/42/comments")]),e._v(".")])]),e._v(" "),s("p",[e._v("Some web frameworks also use "),s("code",[e._v(":")]),e._v("  to define variables. For example,")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("/posts/:id")]),e._v(" matches "),s("code",[e._v("/posts/42")]),e._v(".")]),e._v(" "),s("li",[s("code",[e._v("/posts/:id/comments")]),e._v(" matches "),s("code",[e._v("/posts/42/comments")]),e._v(".")])]),e._v(" "),s("p",[e._v("Some web frameworks even support the glob pattern. For example,")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("/posts/*")]),e._v(" matches "),s("code",[e._v("/posts/42")]),e._v(".")]),e._v(" "),s("li",[s("code",[e._v("/posts/*.*")]),e._v(" matches "),s("code",[e._v("/posts/42.html")]),e._v(" or "),s("code",[e._v("/posts/42.json")]),e._v(".")])]),e._v(" "),s("h4",{attrs:{id:"function-based-resolution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#function-based-resolution"}},[e._v("#")]),e._v(" Function-based Resolution")]),e._v(" "),s("p",[e._v("To make the resolution more generic, a function-based solution is often used as a supplement solution. For example, in "),s("a",{attrs:{href:"https://sinatrarb.com/intro.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sinatra"),s("OutboundLink")],1),e._v(", you can add an extra function to the url resolution:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("set(:probability) { |value| condition { rand <= value } }\n\nget '/win_a_car', :probability => 0.1 do\n  \"You won!\"\nend\n\nget '/win_a_car' do\n  \"Sorry, you lost.\"\nend\n")])])]),s("p",[e._v("We can even use data in the headers or domain. For example, in "),s("a",{attrs:{href:"https://cloud.google.com/appengine/docs/standard/java/how-requests-are-routed",target:"_blank",rel:"noopener noreferrer"}},[e._v("Google App Engine"),s("OutboundLink")],1),e._v(", you can dispatch requests to "),s("code",[e._v("https://simple-sample.appspot.com/mobile/")]),e._v(" and "),s("code",[e._v("https://simple-sample.appspot.com/work/")]),e._v(" by rules defined in below code.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('dispatch:\n  # Send all mobile traffic to the mobile frontend.\n  - url: "*/mobile/*"\n    service: mobile-frontend\n\n  # Send all work to the one static backend.\n  - url: "*/work/*"\n    service: static-backend\n')])])]),s("h4",{attrs:{id:"directory-based-resolution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#directory-based-resolution"}},[e._v("#")]),e._v(" Directory-based Resolution")]),e._v(" "),s("p",[e._v("Based on the similarity of the "),s("code",[e._v("/")]),e._v(" to file path in the file system, some frameworks map URL to script files in the same structure as they are in the filesystem. For example:")]),e._v(" "),s("ul",[s("li",[e._v("URL "),s("code",[e._v("/posts/comments/")]),e._v(" is handled by script "),s("code",[e._v("./posts/comments.php")]),e._v(".")]),e._v(" "),s("li",[e._v("URL "),s("code",[e._v("/posts/42")]),e._v(" is handled by function "),s("code",[e._v("_q_lookup")]),e._v(" in script "),s("code",[e._v("./posts.py")]),e._v(" (Quixote framework).")])]),e._v(" "),s("h3",{attrs:{id:"nested-definition"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nested-definition"}},[e._v("#")]),e._v(" Nested Definition")]),e._v(" "),s("p",[e._v("Duplicate patterns often appear in urls. For example: "),s("code",[e._v("/posts/*/comments")]),e._v(" and "),s("code",[e._v("/posts/*/likes")]),e._v(" share same fragment "),s("code",[e._v("/posts/*")]),e._v(".")]),e._v(" "),s("p",[e._v("We can define patterns in a nested way. For example, in Django, you can define as below:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("post_urls = [\n    path('comments', view.show_comments),\n    path('likes', view.show_likes),\n]\nurls = path('/posts/*' , post_urls)\n")])])]),s("h3",{attrs:{id:"generating-urls"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#generating-urls"}},[e._v("#")]),e._v(" Generating URLs")]),e._v(" "),s("p",[e._v("We have a demand to get URLs from a given routing URL and parameters. We call such use case reverse.")]),e._v(" "),s("p",[e._v("For example, in Flask, you can use "),s("code",[e._v("url_for")]),e._v(" in view function to generate a URL for redirection:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("from flask import url_for, redirect\n\nreturn redirect(url_for('add-post-comment'))\n")])])]),s("p",[e._v("In template, we also can use similar functions:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# post_comment.html\n<a href=\"{% url 'add-post-comment' %}\">Add Comment</a>\n")])])]),s("h2",{attrs:{id:"solutions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#solutions"}},[e._v("#")]),e._v(" Solutions")]),e._v(" "),s("h3",{attrs:{id:"sinatra"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sinatra"}},[e._v("#")]),e._v(" Sinatra")]),e._v(" "),s("p",[e._v("Sinatra framework is simple and elegant.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("get '/posts/:id' do\n    # do something\nend\n")])])]),s("h3",{attrs:{id:"flask"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flask"}},[e._v("#")]),e._v(" Flask")]),e._v(" "),s("p",[e._v("Flask is more tedious but still very short.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("@app.route('/posts/<int:id>')\ndef get_post(id):\n    # do something\n")])])]),s("h3",{attrs:{id:"sprint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sprint"}},[e._v("#")]),e._v(" Sprint")]),e._v(" "),s("p",[e._v("Sprint has similar syntax but with much boilerplate code.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('@RestController\n@SpringBootApplication\npublic class PostApplication {\n\n  @RequestMapping(value = "/posts/{id}")\n  public String comment(@RequestParam String id) {\n    return "Spring in Action";\n  }\n}\n')])])]),s("h3",{attrs:{id:"django"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#django"}},[e._v("#")]),e._v(" Django")]),e._v(" "),s("p",[e._v("In Django, registering is defined in a "),s("code",[e._v("urls.py")]),e._v(" file.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# in views.py\ndef get_post(request, id):\n    # do something\n\n# in urls.py\nurlpatterns = [\n    path('/posts/<int:id>', get_post\n]\n")])])]),s("h3",{attrs:{id:"skipper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skipper"}},[e._v("#")]),e._v(" Skipper")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://opensource.zalando.com/skipper/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Skipper"),s("OutboundLink")],1),e._v(" can route requests via an "),s("a",{attrs:{href:"https://opensource.zalando.com/skipper/data-clients/eskip-file/",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("eskip")]),e._v(" file"),s("OutboundLink")],1),e._v(" like below.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('hello: Path("/hello") -> "https://www.example.org"\'\ngoogleWildcardMatch:\n        *\n        -> setPath("/search")\n        -> setQuery("q", "godoc skipper")\n        -> "https://www.google.com";\n')])])]),s("h2",{attrs:{id:"conclusions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#conclusions"}},[e._v("#")]),e._v(" Conclusions")]),e._v(" "),s("p",[e._v("Web framework routes URLs to functions based on a pre-registered URL rules. It's one of the very core features in any web framework.")]),e._v(" "),s("h2",{attrs:{id:"references"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),s("ul",[s("li",[e._v("https://www.w3.org/Provider/Style/URI")]),e._v(" "),s("li",[e._v("https://t-code.pl/blog/2016/11/Towards-server-side-routing-with-URI-Templates/")]),e._v(" "),s("li",[e._v("https://tools.ietf.org/html/rfc6570")]),e._v(" "),s("li",[e._v("https://docs.djangoproject.com/en/2.0/topics/http/urls/")]),e._v(" "),s("li",[e._v("https://sinatrarb.com/intro.html")]),e._v(" "),s("li",[e._v("https://flask.pocoo.org/docs/0.12/api/#url-route-registrations")]),e._v(" "),s("li",[e._v("https://opensource.zalando.com/skipper/reference/architecture/")])])])}),[],!1,null,null,null);t.default=o.exports}}]);